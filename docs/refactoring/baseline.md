# Baseline Report

> 리팩토링 시작 전 코드베이스 상태 기록  
> 측정일: 2025-11-26

## 1. 개요

리팩토링 전 현재 코드베이스의 품질 지표를 기록합니다.  
이 데이터는 리팩토링 완료 후 개선 정도를 정량적으로 비교하는 기준이 됩니다.

---

## 2. 핵심 지표 요약

| 카테고리       | 지표                  | 값    | 상태                     |
| -------------- | --------------------- | ----- | ------------------------ |
| **테스트**     | 테스트 수             | 35개  | -                        |
| **테스트**     | src/ 커버리지         | 89.0% | ✅                       |
| **품질**       | mypy 에러             | 12개  | ⚠️                       |
| **품질**       | ruff 이슈             | 20개  | ⚠️                       |
| **유지보수성** | Maintainability Index | 90.1  | ✅ A등급                 |
| **복잡도**     | 최대 함수 CC          | 14    | ⚠️ (run_entity_pipeline) |
| **코드량**     | src/ 총 라인 수       | 542줄 | -                        |

---

## 3. 리팩토링 대상 식별

### 3.1 복잡도 높은 파일 (CC 기준)

| 파일                         | 라인 수 | 평균 CC | 최고 CC 함수               |
| ---------------------------- | ------- | ------- | -------------------------- |
| `scripts/run_pipeline.py`    | 457     | 6.67    | `run_entity_pipeline` (14) |
| `src/pipeline/extractors.py` | 200     | 1.7     | `extract` (7)              |
| `src/pipeline/state.py`      | 183     | 3.33    | `get_last_run_time` (5)    |

### 3.2 50줄 초과 파일

현재 **4개** 파일이 50줄을 초과합니다:

- `scripts/run_pipeline.py` (457줄) ← **최우선 리팩토링 대상**
- `src/pipeline/extractors.py` (200줄)
- `src/pipeline/state.py` (183줄)
- `src/pipeline/interfaces.py` (99줄)

---

## 4. 리팩토링 목표

| 지표                      | 현재 | 목표     | 비고             |
| ------------------------- | ---- | -------- | ---------------- |
| mypy 에러                 | 12   | **0**    | 타입 안정성 확보 |
| ruff 이슈                 | 20   | **0**    | 코드 품질 개선   |
| 최대 함수 CC              | 14   | **< 10** | 복잡도 감소      |
| 50줄 초과 파일            | 4    | **0~1**  | 모듈 분리        |
| `run_pipeline.py` 라인 수 | 457  | **< 50** | 진입점만 남김    |

### 4.1 최대 함수 CC: 14 → < 10

**현재 상태:**

`run_entity_pipeline()` 함수의 Cyclomatic Complexity(CC)가 14입니다.

**왜 문제인가:**

- CC는 함수 내 독립적인 실행 경로 수를 측정합니다
- CC 10 이상은 "복잡한 함수"로 분류되며, 테스트와 유지보수가 어려워집니다
- CC 14는 최소 14개의 테스트 케이스가 필요하다는 의미입니다
- 버그가 숨어있을 가능성이 높고, 수정 시 사이드 이펙트 위험이 큽니다

**개선 방향:**

- 조건문/분기를 별도 함수로 추출
- 각 책임(매니페스트 관리, 태그 관리, 캐시 무효화)을 독립 클래스로 분리
- 목표: 각 함수의 CC를 5 이하로 유지

**기대 효과:**

- 단위 테스트 작성 용이
- 버그 발생 시 원인 추적 시간 단축
- 코드 리뷰 효율성 향상

### 4.2 50줄 초과 파일: 4개 → 0~1개

**현재 상태:**

4개 파일이 50줄을 초과합니다. 특히 `run_pipeline.py`는 457줄입니다.

**왜 문제인가:**

- 긴 파일은 스크롤이 많아지고 전체 맥락 파악이 어렵습니다
- 여러 책임이 한 파일에 혼재되어 단일 책임 원칙(SRP) 위반
- Git 충돌 가능성 증가 (여러 작업자가 같은 파일 수정 시)
- IDE에서 파일 탐색/검색 효율 저하

**개선 방향:**

- 파일당 하나의 명확한 책임 부여
- 50줄을 기준으로 분할 검토 (엄격한 규칙은 아님)
- 관련 있는 클래스/함수끼리 모듈화

**기대 효과:**

- 파일명만으로 내용 유추 가능
- 병렬 개발 시 충돌 최소화
- 필요한 코드만 빠르게 찾기 가능

### 4.3 `run_pipeline.py` 라인 수: 457줄 → < 50줄

**현재 상태:**

파이프라인 진입점 파일에 다음 책임들이 혼재되어 있습니다:

1. 파이프라인 실행 로직 (`run_entity_pipeline`)
2. 매니페스트 관리 (S3에서 로드/저장)
3. S3 태그 관리 (`update_s3_tags`)
4. CloudFront 캐시 무효화
5. 엔티티 상수 정의 (`EXECUTION_ORDER`, `ALL_ENTITIES`)

**왜 문제인가:**

- **테스트 불가**: 457줄의 스크립트를 단위 테스트하기 어려움
- **재사용 불가**: 다른 곳에서 매니페스트 로직만 쓰고 싶어도 전체 import 필요
- **변경 위험**: 태그 로직 수정이 파이프라인 실행에 영향 가능
- **이해 비용**: 새 개발자가 코드 파악에 시간 소요

**개선 방향:**

```text
# Before (현재)
scripts/run_pipeline.py (457줄) - 모든 것이 혼재

# After (목표)
src/pipeline/
├── orchestrator.py      # 파이프라인 조율 (~100줄)
├── manifest.py          # 매니페스트 관리 (~50줄)
├── tag_manager.py       # S3 태그 관리 (~40줄)
├── cache_invalidator.py # CloudFront 무효화 (~30줄)
└── constants.py         # 상수 정의 (~20줄)

scripts/run_pipeline.py  # 진입점만 (~50줄)
```

**기대 효과:**

- 각 모듈별 독립 테스트 가능
- 책임 분리로 변경 영향 범위 최소화
- 코드 재사용성 향상
- 진입점은 의존성 주입과 실행만 담당

---

## 5. 모듈 구조

```text
src/pipeline/
├── auth.py          (23줄)   ✅ 간결
├── loaders.py       (37줄)   ✅ 간결
├── extractors.py    (200줄)  ⚠️ 분할 검토
├── state.py         (183줄)  ⚠️ 분할 검토
└── interfaces.py    (99줄)   ✅ 적정
```

- 파일 수: **5개**
- 평균 파일 크기: **108.4줄**

---

## 6. 참고

- 측정 도구: `scripts/run_benchmarks.py`
- 상세 데이터: [`benchmarks/data/2025-11-26_baseline.json`](./benchmarks/data/2025-11-26_baseline.json)
- 리팩토링 계획: [`06_Refactoring.md`](./06_Refactoring.md)
