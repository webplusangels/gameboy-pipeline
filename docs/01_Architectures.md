# 01. 구조에 대해

이 문서는 프로젝트의 구조와 그에 관련된 문제를 다루는 문서입니다. 제가 느낀 문제점과 실제 문제를 어떻게 해결할지에 대한 고민을 중심으로 서술합니다.

## 왜 확장 가능한 구조를 목표로 했는가?

제가 이전에 2개월간 개발한 [game-pricing-pipeline](https://github.com/webplusangels/game-pricing-pipeline)은 [WARA:B](https://github.com/100-hours-a-week/9-team-gudokjohayo-warab-be)(백엔드 레포) 프로젝트의 일부로 운영을 위한 데이터 관련 작업을 자동화하는 파이프라인 모듈입니다.

이 파이프라인은 서비스의 요구 사항인 한국어, PC 게임, 할인가 수집 등을 만족하기 위해 Steam API를 포함한 5-6개의 서드 파티 API들에게서 수집한 데이터들을 통합하여 설계한 데이터 ERD에 맞게 정제하고, 업서트 작업을 cron 스케줄링으로 자동화하여 구현하였습니다. 이 과정에서 주요 병목인 수집 과정을 최적화하기 위해 파일 시스템 기반의 기초적인 캐싱 시스템을 활용하고, python 기본 로그 라이브러리를 이용해 로깅하며 에러를 직접 확인하였습니다. 그 결과 실제로 수동 수집 기준 **1/6** 수준의 수집 시간 단축과, 운영 기간 동안의 데이터 수집 오류를 **0%**, 그러니까 완전히 배제할 수 있었습니다.

그러나 파이프라인 개발이 처음인데다, 구조에 대한 충분한 고민 없이 짧은 시간 구현에 집중하다보니 개발 후에는 많은 한계점들이 발견되었습니다. 문제점들을 요약하자면 다음과 같습니다.

- ❌ 코드의 가독성과 낮은 유지 보수성
- ❌ 긴 실행 시간 (배치 작업 최적화 부족)
- ❌ 테스트 안정성 부재 (트러블슈팅 시간 증가)

사소한 오류가 긴 시간의 트러블 슈팅과 테스트로 이어지는 고통스러운 과정은, 소프트웨어 개발 이론에서만 배웠던 **낮은 결합도, 높은 응집도**의 필요성을 체감하게 했습니다. 이는 오류 해결을 위한 소프트웨어 유지 보수 시도 자체가 차단되는 수준의 심각한 문제점으로 이어지고 있었습니다.

현재와 같은 목표를 세우기 위해 여러 시행착오를 거치며 v2에 대한 구상을 이어나갔습니다. 데이터를 다루기 위해 **Python**, **헥사고날 아키텍처**, **파일 시스템 기반의 캐싱 시스템**, **Redis 캐싱 모듈**, **TDD** 등의 키워드들에 대해 깊게 공부하고, 개발했던 모듈의 근본적인 문제점들을 파악하며 현재 실무에서 사용되고 있는 기술들을 활용한 빠르고 현대적인 파이프라인의 구조에 대해 파악하였습니다.

현재 제가 설계하려는 파이프라인은 다음과 같은 목표를 가지고 있습니다.

### 안정적인 진실 공급원

IGDB는 Twitch에서 운영중인 게임 관련 오픈 소스 API입니다. 모기업이 Amazon인 만큼 거의 가장 크면서 상업적인 이용에 아무런 제약이 없고, 아마도 관련 데이터베이스 중 가장 안정적으로 공급될 API일 것입니다.

이전 파이프라인에서는 Steam에서 서비스 목적인 PC게임만을 데이터로 받았다면, 현재 구상 중인 파이프라인은 ELT, 즉 해당 API에서 추출한 모든 데이터를 적재하고 이를 용도에 맞게 변형하는 플로우를 통해 L과 T의 의존성을 줄이는 동시에, 비교적 단순한 로직으로 구현할 수 있습니다.

### 가볍고 현대적인 구조

Python의 추상 클래스를 이용한 인터페이스 기반 설계로 가볍고 현대적인 구조화를 구현하여, 이후 점진적인 개선 작업이 가능하도록 합니다.

이 프로젝트에서 장기적인 목표로 하는 것들은 결국 현재 활발히 사용되고 있는 도구들과의 성공적인 통합이고, 이를 위해 코어 로직과의 결합도가 보다 낮아질 필요가 있습니다. 이를 위해 추상 클래스로 설계도를 먼저 제시하면, 이를 구현하는 방식을 통해 의존성 역전을 실현할 수 있습니다. 이는 TDD의 핵심인 테스트 스위트를 원활하게 정의하는 데도 도움이 됩니다.

### TDD 개발 방식

TDD는 다음과 같은 순서를 ([RED] -> [GREEN] -> [REFACTOR]) 반복하며 기능을 구현하는 개발 방식입니다. 필요한 기능만을 작성할 수 있기 때문에 코드의 단순함을 유지할 수 있고, 안정적인 코드 개선이 가능합니다. 특히 문제가 되었던 코드의 높은 결합도를 낮추는데 도움이 되고, 설계 단계에서 미리 문제점을 확인할 수 있습니다.

테스트의 초기 작성 시간이나 개발 효율, 그리고 러닝 커브와 같은 부분이 단점으로 작용할 수 있지만 제 프로젝트는 최대한 작은 규모를 유지하면서도 안정적인 설계를 필요로 하기 때문에 알맞은 방법이라고 생각했습니다.

### 타입 안정성

Python은 기본적으로 타입을 강제하는 언어는 아니지만, 타입 시스템이 도입되면서 `FastAPI`와 같은 프레임워크에는 표준처럼 쓰이는 상황입니다.

제가 경험한 Python 개발 경험에 따르면, 타입 안정성은 개발 안정성에 큰 장점을 가지며 특히 테스트를 활용한 개발 경험에서 잘 맞는다고 생각했습니다. Meta, JetBrains, Microsoft 등에서 진행한 [설문조사](https://www.linkedin.com/posts/alexandrevs_typed-python-in-2024-well-adopted-yet-usability-activity-7298661426624110592-2vJC)에 따르면 Python 개발자의 88%가 타입 힌트를 자주 사용한다고 밝혔습니다. 제 생각에도 아마 이 부분은 지속적으로 더 늘어날 것이라고 생각합니다.

### 데이터 기반 점진적 기능 향상

기능 향상은 항상 데이터를 기반으로 하겠다는 개인적인 다짐을 이 프로젝트에서 적용시키고 싶습니다. 프로젝트 자체가 데이터를 기반으로 한 파이프라인 구현이 목표인 만큼, 파이프라인의 효율성 향상에 대한 많은 아이디어가 있는데요. 이 부분에 대해서 직접 실험해보고, 다양한 도구들을 사용해 보면서 점진적으로 기능을 확장시키고, 향상시키는 프로젝트를 완성시키고 싶습니다.

### 체계적인 문서화

현재 이 문서와 같이 프로젝트에 학습 기록을 남기고 현재 생각하고 있는 부분을 문서로 남기는 점은 중요하다고 생각합니다.기술 문서 작성과 기술 이해도와 연계된 컴퓨터 과학을 탑 다운 방식으로 직접 체득하는 것은 효과적인 공부 방식이기도 하기 때문에 계속해서 철저히 문서화하여 프로젝트 전체를 쉽게 기술할 수 있도록 노력하겠습니다.

## Extractor와 Loader에 대한 설명 (인터페이스, 유연성, 테스트 용이성)

## 아키텍처 다이어그램
